{% extends 'base.html' %}
{% load static %}
{% block title %}<title> :: Instalações </title> {% endblock %}

{% block main %}
<div class="container">
    
  <!-- INÍCIO Messagens -->
    {% if messages %}
      {% for message in messages %}
        <div class="alert {{ message.tags }}" role="alert">
            {{ message }}
        </div>
      {% endfor %}
    {% endif %}
  <!-- FIM Messagens -->   
  
  <!-- INiCIO dos botões de opções -->
  <div class="card shadow mt-4 border-0">
    <div align="right">
      <a class="btn btn-primary" href="cadastro-instalacao/">Adicionar Instalação</a>
      <a class="btn btn-danger" href="criar-cancelamento/">Cancelamento</a>
      <a class="btn btn-info" href="lista-cancelamentos/">Lista de cancelamentos</a>
    </div>
  </div>
  <!-- FIM dos botões de opções -->


  <!--INICIO dos status de instalações -->
  <div class="card shadow mt-4">
    <div class="card-deck">
      
      <div class="card border-danger" align="center">
        <div class="card-group">
          <div class="card border-0">
            <h5>Aberto</h5>
          </div>
          <div class="card border-0">
            <div class="display-4"><strong>{{quant_aberta}}</strong></div>
          </div>
        </div>
        <div class="card-footer border-danger">
          <a href="instalacao-aberta/" class="btn btn-danger">Ver todos</a>
        </div>
      </div>

      <div class="card border-warning" align="center">
        <div class="card-group">
          <div class="card border-0">
            <h5>Agendado</h5>
          </div>
          <div class="card border-0">
            <div class="display-4"><strong>{{quant_agendada}}</strong></div>
          </div>
        </div>
        <div class="card-footer border-warning">
          <a href="instalacao-agendada/" class="btn btn-warning text-white">Ver todos</a>
        </div>
      </div>

      <div class="card border-dark" align="center">
        <div class="card-group">
          <div class="card border-0">
            <h5 class="mt-3">Sem boleto</h5>
          </div>
          <div class="card border-0">
            <div class="display-4"><strong>{{ quant_sem_boleto }}</strong></div>
          </div>
        </div>
        <div class="card-footer border-dark">
          <a href="instalacao-finalizada-sem-boleto/" class="btn btn-dark">Ver todos</a>
        </div>
      </div>

      <div class="card border-success" align="center">
        <div class="card-group">
          <div class="card border-0">
            <h5>Finalizados</h5>
          </div>
          <div class="card border-0">
            <div class="display-4"><strong>{{quant_concluida}}</strong></div>
          </div>
        </div>
        <div class="card-footer border-success">
          <a href="instalacao-concluida/" class="btn btn-success">Ver todos</a>
        </div>
      </div>
    </div>
  </div>
  <!--FIM dos status de instalações -->

  <!-- INICIO Gráfico de instalações por mês -->
  {% if request.user.groups.all.0.name == "Master" %}
  <div class="card shadow mt-5">
    <canvas id="speedChartA" width="600" height="100">
        <script>
            
            var speedCanvas = document.getElementById("speedChartA");
  
            Chart.defaults.global.defaultFontFamily = "Lato";
            Chart.defaults.global.defaultFontSize = 16;
  
            var speedData = {
            labels: [ {% for mensal in mensalInstalacao %}'{{ mensal.month|date:"F Y"  }}',{% endfor %} ],
            datasets: [{
                label: "Instalações (mês)",
                data: [{% for mensal in mensalInstalacao %} '{{ mensal.c }}', {% endfor %}],
            }]
            };
  
            var chartOptions = {
            legend: {
                display: true,
                position: 'top',
                labels: {
                boxWidth: 80,
                fontColor: 'black'
                }
            }
            };
  
            var lineChart = new Chart(speedCanvas, {
            type: 'line',
            data: speedData,
            options: chartOptions
            });
        </script>
    </canvas>
  </div> 
  {% endif %}
  <!-- FIM Gráfico de instalações por mês -->

  <!-- INICIO Gráfico de instações diárias -->
  <div class="card shadow mt-5 mb-4">
    <canvas id="speedChart" width="400" height="100">
        <script>
          var speedCanvas = document.getElementById("speedChart");
          var speedCanvas = document.getElementById("speedChart");

          Chart.defaults.global.defaultFontFamily = "Lato";
          Chart.defaults.global.defaultFontSize = 18;

          var speedData = {
            labels: [
            {% for diario in diarioInstalaçao %} '{{ diario.data_finalizacao|date:"F Y" }}', {% endfor %}
          ],
            datasets: [{
              label: "Instalação (dia)",
              data: [
              {% for diario in diarioInstalaçao %} '{{ diario.number}}', {% endfor %}
            ],
              lineTension: 0,
              fill: false,
              borderColor: 'blue',
              backgroundColor: 'transparent',
              borderDash: [3, 3],
              pointBorderColor: 'blue',
              pointBackgroundColor: 'blue',
              pointRadius: 5,
              pointHoverRadius: 10,
              pointHitRadius: 30,
              pointBorderWidth: 2,
              pointStyle: 'rectRounded'
            }]
          };

          var chartOptions = {
            legend: {
              display: true,
              position: 'top',
              labels: {
                boxWidth: 80,
                fontColor: 'black'
              }
            }
          };

          var lineChart = new Chart(speedCanvas, {
            type: 'line',
            data: speedData,
            options: chartOptions
          });
        </script>
    </canvas>
    
  </div>
  <!-- FIM Gráfico de instações diárias -->

</div>
{% endblock %}